<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.sist.admin.payment.AdminPaymentMapper">

<!-- 수익 관리 우측의 강사 선택 -->
<select id="selectAllInst" resultType="string">
select name as inst_name
from instructor
</select>

<!-- 강의 총 수익 데이터(환불/취소 불가 기준) 수강생*강의 가격으로 계산-->
<select id="selectAllProfit" resultType="int">
select sum(l.price * l.usercount) as total_profit
from lecture l
</select>

<select id="selectAdminProfit" resultType="int">
select sum(l.price * l.usercount * 0.5) as total_profit
from lecture l
</select>

<!-- 수익 관리 데이터 -->
<select id="selectLectProfit" parameterType="paymentSearchDTO" resultType="lectProfitDomain">
select p.time as time, l.name as lect_name, i.name as inst_name, p.price as inst_profit
from payment p
join payment_detail pd
on p.payrec_id=pd.payrec_id
join payment_detail2 pd2
on pd.payrec_id=pd2.payrec_id
join lecture l
on l.lect_id=pd2.lect_id
join instructor i
on i.inst_id=l.inst_id
where p.state=1
<if test="instName != null and instName != ''">
and i.name = #{instName}
</if>
</select>

</mapper>