<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>관리자 대시보드</title>
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" />
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
<link rel="stylesheet" th:href="@{/admin/dashboard/dashboard.css}" />
<link rel="stylesheet" th:href="@{/admin/lecture/notApprLecture.css}" />
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script type="text/javascript">
$(function(){

});

//카테고리 누를 때 변경하는 테이블 데이터
function lectByCategory(){
	var categoryName=$("#category").val();
	
	$.ajax({
		url:"/admin/lecture/searchNotApprCategoryLect",
		type:"GET",
		data:{categoryName: categoryName},
		dataType:"json",
		error:function(xhr){
			alert(xhr.status);
		},
		success:function(data){
			var tbody = $("#lectureTableBody");
			tbody.empty();
			
			//데이터가 없으면 메시지 출력
			if (!data || data.length === 0) {
			    tbody.append('<tr><td colspan="5">데이터 없음</td></tr>');
			    return;
			}
			
			data.forEach(function(lect){
				var dateStr = lect.regDate ? lect.regDate.substring(0, 10) : '';
			    var statusHtml = (lect.approval == 1)
			      ? '<span>승인</span>'
			      : '<span>대기중</span>';
				
			    var row = `
			      <tr class="course-row">
			        <td class="course-thumb">
			          <img src="/common/images/${lect.thumbnail}" alt="">
			        </td>
			        <td class="course-title">
			          <a href="/admin/lecture/searchDetailNotApprLect?lectureId=${lect.lect_id}">
			            ${lect.lect_name}
			          </a>
			        </td>
			        <td class="status status--open">${dateStr}</td>
			        <td>${lect.inst_name}</td>
			        <td class="status status--open">${statusHtml}</td>
			      </tr>
			    `;
			    tbody.append(row);
			  });
		}//success
	});
}
</script>
</head>
<body class="admin-dashboard">
  <div id="header">
    <th:block th:replace="~{fragments/adminHeader :: adminHeader}"></th:block>
  </div>

  <div class="admin-layout">
    <!-- 왼쪽 사이드바 -->
    <aside class="admin-sidebar">
    	<th:block th:replace="~{fragments/adminSidebar :: adminSidebar}"></th:block>
    </aside>
    <!-- 좌측 상단 제목 -->
    <main class="admin-content">
      <section class="course-page">
        <header class="course-header">
          <h1>강의 관리</h1>
        </header>

		<!-- 옵션 선택바 -->
        <div class="course-toolbar">
          <div class="course-filter">
            <label class="sr-only" for="category">카테고리</label>
            <select id="category" name="categoryName" onchange="lectByCategory()">
              <option th:value="${category}">전체</option>
              <option th:each="category:${categoryList}"
               th:value="${category}" th:text="${category}" th:selected="${category} == ${alsDTO.categoryName}"></option>
            </select>
          </div>
        </div>

		<!-- 테이블 내용 -->
        <table class="course-table">
          <thead>
            <tr>
              <th>이미지</th>
              <th>강의명</th>
              <th>등록일</th>
              <th>강사</th>
              <th>상태</th>
            </tr>
          </thead>
          <tbody id="lectureTableBody">
            <tr class="course-row" th:each="notApprLects : ${notApprLectList}" th:object="${notApprLects}">
              <td class="course-thumb">
                <img th:src="@{'/common/images/'+*{thumbnail}}" alt="">
              </td>
              <td class="course-title"><a th:href="@{/admin/lecture/searchDetailNotApprLect(lectureId=*{lect_id})}" th:text="*{lect_name}"></a></td>
              <td class="status status--open" th:text="*{regDate}"></td>
              <td th:text="*{inst_name}"></td>
              <td class="status status--open">
              	<span th:if="*{approval eq 1}">승인</span>
              	<span th:unless="*{approval eq 1}">대기중</span>
              </td>
            </tr>
          </tbody>
        </table>
      </section>
    </main>
  </div>
  
</body>

</html>
